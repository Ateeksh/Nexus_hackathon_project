<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fit AI</title>
</head>

<body>
  <table id="dietTable" border="1">
    <thead>
      <tr>
        <th>Food Name</th>
        <th>Calories</th>
        <th>Protein</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be added here dynamically -->
    </tbody>
  </table>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      const name = localStorage.getItem("name");
      get_diet(name).then((res) => {
        console.log(res)
        const tbody = document.querySelector("#dietTable tbody");
        res.forEach(item => {
          const row = document.createElement("tr");

          const foodNameCell = document.createElement("td");
          foodNameCell.textContent = item.food_name;
          row.appendChild(foodNameCell);

          const caloriesCell = document.createElement("td");
          caloriesCell.textContent = item.calories;
          row.appendChild(caloriesCell);

          const proteinCell = document.createElement("td");
          proteinCell.textContent = item.protein;
          row.appendChild(proteinCell);

          const actionCell = document.createElement("td");
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.addEventListener("click", () => {
            row.remove();
          });
          actionCell.appendChild(deleteButton);
          row.appendChild(actionCell);

          tbody.appendChild(row);
        });
      });
    })
    async function get_diet(name) {
            const url_path = "/app/get_diet";
            const inputData = { name: name };
            try {
            const response = await fetch(url_path, {
              method: 'POST',
              headers: {
              'Content-Type': 'application/json',
              },
              body: JSON.stringify(inputData)
            });

            if (!response.ok) {
              const errorData = await response.json();
              console.error("Error:", errorData);
              return null;
            }

            const data = await response.json();
            return data.food;
            } catch (error) {
            console.error("Fetch error:", error);
            return null;
            }
          }
  </script>
</body>

</html>
